防抖与节流

为什么要做防抖于节流？

对于许多高频事件，降低代码执行频率。

- onscroll

  例如页面滚动中绑定函数，在执行页面滚动时，会发现被绑定的函数执行非常高

- oninput

  输入框查询内容，不能在鼠标或键盘按下时就调用接口，应该在用户稳定时，再调用接口查询数据

- resize

  屏幕尺寸变化

- onkeyup

  键盘释放

- keydown

  键盘按下

网页展示过程：

- JavaScript：通过js操作DOM，将元素插入页面；
- Style：为元素添加样式；
- Layout：为元素添加样式后，并未立即添加到页面，而是先计算元素大小与位置，进行布局；
- Paint：将计算好位置的DOM元素分层绘制渲染于页面；
- Composite：渲染层合并。写动画建议使用3D效果，translate3d，脱离文档流，不用合并层。

![image-20201219180319438](/Users/haohaiyou/Library/Application Support/typora-user-images/image-20201219180319438.png)

> 重绘与重排：样式变化导致重绘，DOM元素位置变化导致重排。重排必然导致重绘。

用户 scroll 和 resize 行为会导致页面不断重新渲染，如果在定的回调函数中大量操作dom将会导致页面卡顿。例如页面滚动到底部通过回调函数将新内容加载到页面，页面滚动到底部会频繁触发回调函数，第一次渲染还没完毕时，下一个回调已执行并进行第二次渲染，多个后导致页面卡顿。可减少回调触发频率。

![image-20201219182412761](/Users/haohaiyou/Library/Application Support/typora-user-images/image-20201219182412761.png)

函数节流（throttle）

节流就是保证一段时间内，核心代码只执行一次。例如：水滴积攒到一定重量才会下落。



防抖（debounce）

防抖就是一段时间结束后，才能触发一次事件，如果一段时间未结束再次触发事件，就会重新开始计算时间。例如：电梯中门即将关闭，突然有人准备上来，电梯并没有改变楼层，而是再次打开电梯门。电梯延迟了改变楼层的功能，但是优化了资源。









